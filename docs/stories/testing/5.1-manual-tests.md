# Manual Testing Scenarios - Story 5.1: User Account Management Interface

**Story:** 5.1 - User Account Management Interface  
**Date Created:** 2025-10-29  
**Last Updated:** 2025-10-29  
**Test Environment:** Local Development / Staging

---

## Overview

This document provides comprehensive manual testing scenarios for the User Account Management feature. These tests should be executed by QA to validate all acceptance criteria and edge cases before production deployment.

### Prerequisites

- Application running locally or on staging environment
- Test users seeded in database:
  - HR Admin: `admin@test.com` (password: `adminpass123`)
  - Sodexo User: `sodexo@test.com` (password: `sodexopass123`)
  - OMC User: `omc@test.com` (password: `omcpass123`)
- Browser: Chrome/Firefox/Edge (latest version)
- Screen reader (optional): NVDA/JAWS/VoiceOver for accessibility testing

---

## Test Scenario 1: Create New User with All Roles

**Objective:** Verify HR Admin can create users with different roles

**Prerequisites:** Logged in as HR Admin

### Test Steps

| Step | Action                                                          | Expected Result                                                                                   |
| ---- | --------------------------------------------------------------- | ------------------------------------------------------------------------------------------------- |
| 1    | Navigate to `/dashboard/admin/users`                            | User Management page loads successfully                                                           |
| 2    | Click "Add User" button                                         | Modal opens with title "Add New User"                                                             |
| 3    | Enter email: `test-sodexo@example.com`                          | Email field accepts input                                                                         |
| 4    | Enter password: `testPass123`                                   | Password field accepts input (masked)                                                             |
| 5    | Select role: "Sodexo" from dropdown                             | Dropdown shows all 5 roles, Sodexo selected                                                       |
| 6    | Leave "Active" checkbox checked                                 | Checkbox remains checked (default)                                                                |
| 7    | Click "Create User"                                             | Loading state shows "Creating..."                                                                 |
| 8    | Wait for submission to complete                                 | Success toast appears with email and temporary password                                           |
| 9    | Verify toast message                                            | "User test-sodexo@example.com created successfully. Initial password: testPass123" (10s duration) |
| 10   | Check user table                                                | New user appears in table with correct role and active status                                     |
| 11   | Repeat steps 2-10 for each role: OMC, Payroll, Toplux, HR Admin | All users created successfully                                                                    |

**Pass Criteria:**

- ✓ All roles can be selected from dropdown
- ✓ Users created successfully for each role
- ✓ Success toast displays temporary password
- ✓ New users appear in table immediately

**Acceptance Criteria Covered:** AC3, AC4, AC5

---

## Test Scenario 2: Deactivate User and Verify Login Prevention

**Objective:** Verify deactivated users cannot log in

**Prerequisites:** Logged in as HR Admin, test user `test-sodexo@example.com` exists and is active

### Test Steps

| Step | Action                                         | Expected Result                                                                                                             |
| ---- | ---------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------- |
| 1    | Navigate to `/dashboard/admin/users`           | User Management page loads                                                                                                  |
| 2    | Locate `test-sodexo@example.com` in table      | User shown with "Active" status badge (green)                                                                               |
| 3    | Click "Deactivate" button for this user        | Confirmation dialog appears                                                                                                 |
| 4    | Read dialog message                            | "Are you sure you want to deactivate **test-sodexo@example.com**? They will be logged out and unable to access the system." |
| 5    | Click "Cancel"                                 | Dialog closes, user remains active                                                                                          |
| 6    | Click "Deactivate" again                       | Dialog appears again                                                                                                        |
| 7    | Click "Confirm"                                | Loading state shows "Processing..."                                                                                         |
| 8    | Wait for completion                            | Success toast: "User test-sodexo@example.com deactivated successfully"                                                      |
| 9    | Check user table                               | User status changed to "Inactive" (red badge)                                                                               |
| 10   | Check button for this user                     | "Activate" button shown instead of "Deactivate"                                                                             |
| 11   | Log out as HR Admin                            | Redirected to login page                                                                                                    |
| 12   | Attempt to log in as `test-sodexo@example.com` | Login fails with appropriate error message                                                                                  |
| 13   | Verify error message                           | User informed account is inactive/disabled                                                                                  |

**Pass Criteria:**

- ✓ Confirmation dialog prevents accidental deactivation
- ✓ User status updates in table immediately
- ✓ Deactivated user cannot log in
- ✓ Auth session revoked (existing sessions terminated)

**Acceptance Criteria Covered:** AC6, AC7

---

## Test Scenario 3: Activate User and Verify Login Success

**Objective:** Verify activated users can log in again

**Prerequisites:** User `test-sodexo@example.com` is deactivated

### Test Steps

| Step | Action                                             | Expected Result                                                                                     |
| ---- | -------------------------------------------------- | --------------------------------------------------------------------------------------------------- |
| 1    | Navigate to `/dashboard/admin/users` (as HR Admin) | User Management page loads                                                                          |
| 2    | Locate `test-sodexo@example.com` in table          | User shown with "Inactive" status badge (red)                                                       |
| 3    | Click "Activate" button for this user              | Confirmation dialog appears                                                                         |
| 4    | Read dialog message                                | "Are you sure you want to activate **test-sodexo@example.com**? They will be able to log in again." |
| 5    | Click "Confirm"                                    | Loading state shows "Processing..."                                                                 |
| 6    | Wait for completion                                | Success toast: "User test-sodexo@example.com activated successfully"                                |
| 7    | Check user table                                   | User status changed to "Active" (green badge)                                                       |
| 8    | Check button for this user                         | "Deactivate" button shown instead of "Activate"                                                     |
| 9    | Log out as HR Admin                                | Redirected to login page                                                                            |
| 10   | Log in as `test-sodexo@example.com` with password  | Login succeeds, redirected to dashboard                                                             |
| 11   | Verify dashboard access                            | User can access appropriate features for Sodexo role                                                |

**Pass Criteria:**

- ✓ Activation updates user status immediately
- ✓ Activated user can log in successfully
- ✓ User has correct role permissions after activation

**Acceptance Criteria Covered:** AC6, AC8

---

## Test Scenario 4: Prevent Self-Deactivation

**Objective:** Verify HR Admin cannot deactivate their own account

**Prerequisites:** Logged in as HR Admin (`admin@test.com`)

### Test Steps

| Step | Action                                       | Expected Result                                              |
| ---- | -------------------------------------------- | ------------------------------------------------------------ |
| 1    | Navigate to `/dashboard/admin/users`         | User Management page loads                                   |
| 2    | Locate own account `admin@test.com` in table | Row displayed with "Active" status                           |
| 3    | Check "Deactivate" button for own account    | Button is disabled (grayed out, not clickable)               |
| 4    | Hover over disabled button                   | Tooltip or title shows: "Cannot deactivate your own account" |
| 5    | Attempt to click button (if possible)        | No action occurs, button remains disabled                    |

**Alternative Test (if UI allows click):**

| Step | Action                               | Expected Result                                   |
| ---- | ------------------------------------ | ------------------------------------------------- |
| 1    | Navigate to `/dashboard/admin/users` | User Management page loads                        |
| 2    | Click "Deactivate" on own account    | API request fails                                 |
| 3    | Check response                       | Error toast: "Cannot deactivate your own account" |

**Pass Criteria:**

- ✓ Self-deactivation prevented at UI level (button disabled)
- ✓ If UI bypass attempted, API blocks request
- ✓ Clear error message explains why action is prevented

**Acceptance Criteria Covered:** AC9

---

## Test Scenario 5: Form Validation Errors Display Correctly

**Objective:** Verify all form validations work and display clear error messages

**Prerequisites:** Logged in as HR Admin

### Test Steps: Email Validation

| Step | Action                                       | Expected Result                               |
| ---- | -------------------------------------------- | --------------------------------------------- |
| 1    | Click "Add User" button                      | Modal opens                                   |
| 2    | Leave email field empty, click "Create User" | Error message: "Email is required" or similar |
| 3    | Enter invalid email: "notanemail"            | Error displays inline: "Invalid email format" |
| 4    | Enter invalid email: "test@"                 | Error displays inline: "Invalid email format" |
| 5    | Enter valid email: "valid@example.com"       | Error message disappears                      |

### Test Steps: Password Validation

| Step | Action                                          | Expected Result                                                 |
| ---- | ----------------------------------------------- | --------------------------------------------------------------- |
| 1    | Leave password field empty, click "Create User" | Error message: "Password is required" or similar                |
| 2    | Enter short password: "pass"                    | Error displays inline: "Password must be at least 8 characters" |
| 3    | Enter password: "1234567" (7 chars)             | Error displays inline: "Password must be at least 8 characters" |
| 4    | Enter password: "12345678" (8 chars)            | Error message disappears                                        |

### Test Steps: Role Validation

| Step | Action                             | Expected Result                                                       |
| ---- | ---------------------------------- | --------------------------------------------------------------------- |
| 1    | Open role dropdown                 | All 5 roles displayed: HR Administrator, Sodexo, OMC, Payroll, Toplux |
| 2    | Select each role                   | Selection updates dropdown display                                    |
| 3    | Submit form without selecting role | Default role (Sodexo) is used, or validation error shown              |

### Test Steps: Concurrent Validation

| Step | Action                              | Expected Result                            |
| ---- | ----------------------------------- | ------------------------------------------ |
| 1    | Submit form with all fields invalid | All error messages display simultaneously  |
| 2    | Verify error messages don't overlap | Each field shows its own error below input |
| 3    | Fix email, leave password invalid   | Email error clears, password error remains |

**Pass Criteria:**

- ✓ All validation errors display inline below their respective fields
- ✓ Error messages are clear and actionable
- ✓ Errors clear immediately when field becomes valid
- ✓ Form cannot be submitted while validation errors exist

**Acceptance Criteria Covered:** AC11

---

## Test Scenario 6: Role-Based Access Control

**Objective:** Verify non-admin users cannot access User Management

**Prerequisites:** Test users for each role exist

### Test Steps: Navigation Link Visibility

| Step | Action                                          | Expected Result                                 |
| ---- | ----------------------------------------------- | ----------------------------------------------- |
| 1    | Log in as HR Admin (`admin@test.com`)           | Dashboard loads                                 |
| 2    | Check navigation menu                           | "User Management" link visible in navigation    |
| 3    | Log out                                         | Redirected to login                             |
| 4    | Log in as Sodexo user (`sodexo@test.com`)       | Dashboard loads                                 |
| 5    | Check navigation menu                           | "User Management" link NOT visible              |
| 6    | Repeat steps 3-5 for OMC, Payroll, Toplux roles | "User Management" link NOT visible for any role |

### Test Steps: Direct URL Access

| Step | Action                                                   | Expected Result                                       |
| ---- | -------------------------------------------------------- | ----------------------------------------------------- |
| 1    | Log in as Sodexo user                                    | Dashboard loads                                       |
| 2    | Navigate directly to `/dashboard/admin/users` in URL bar | One of:                                               |
|      |                                                          | - Redirected to `/dashboard` with error message       |
|      |                                                          | - 403 Forbidden page displayed                        |
|      |                                                          | - Access denied message shown                         |
| 3    | Verify user remains logged in                            | Session not terminated, can navigate to allowed pages |

### Test Steps: API Endpoint Access

| Step | Action                                                            | Expected Result                              |
| ---- | ----------------------------------------------------------------- | -------------------------------------------- |
| 1    | Log in as Sodexo user                                             | Dashboard loads                              |
| 2    | Open browser Developer Tools (F12)                                | DevTools opens                               |
| 3    | Go to Console tab                                                 | Console ready                                |
| 4    | Execute fetch request:                                            | 403 Forbidden response                       |
|      | `fetch('/api/admin/users').then(r => r.json()).then(console.log)` | Error: "HR Admin access required" or similar |

**Pass Criteria:**

- ✓ Only HR Admin sees "User Management" in navigation
- ✓ Non-admin roles cannot access page via direct URL
- ✓ API endpoints return 403 Forbidden for non-admin requests
- ✓ Clear error messages explain insufficient permissions

**Acceptance Criteria Covered:** AC1, AC10

---

## Test Scenario 7: Duplicate Email Prevention

**Objective:** Verify system prevents creating users with duplicate emails

**Prerequisites:** User `existing@example.com` already exists

### Test Steps

| Step | Action                                  | Expected Result                                    |
| ---- | --------------------------------------- | -------------------------------------------------- |
| 1    | Navigate to `/dashboard/admin/users`    | User Management page loads                         |
| 2    | Click "Add User"                        | Modal opens                                        |
| 3    | Enter email: `existing@example.com`     | Email field accepts input                          |
| 4    | Enter password: `password123`           | Password field accepts input                       |
| 5    | Select role: "OMC"                      | Role selected                                      |
| 6    | Click "Create User"                     | Loading state shows                                |
| 7    | Wait for response                       | Error toast: "User with this email already exists" |
| 8    | Verify modal remains open               | Modal still displayed, form values retained        |
| 9    | Change email to `newunique@example.com` | Email field updated                                |
| 10   | Click "Create User" again               | Success toast appears, user created                |

**Pass Criteria:**

- ✓ Duplicate email rejected by server (409 Conflict)
- ✓ Clear error message displayed
- ✓ Form stays open to allow correction
- ✓ Unique email succeeds

**Acceptance Criteria Covered:** AC4

---

## Test Scenario 8: User List Display and Sorting

**Objective:** Verify user list displays correctly with all required information

**Prerequisites:** Multiple users exist with different roles and statuses

### Test Steps

| Step | Action                               | Expected Result                                        |
| ---- | ------------------------------------ | ------------------------------------------------------ |
| 1    | Navigate to `/dashboard/admin/users` | User Management page loads                             |
| 2    | Verify table columns                 | Headers: Email, Role, Status, Created, Actions         |
| 3    | Check email display                  | All user emails displayed in first column              |
| 4    | Check role display                   | Roles displayed as friendly names (not enum values):   |
|      |                                      | - `hr_admin` → "HR Administrator"                      |
|      |                                      | - `sodexo` → "Sodexo"                                  |
| 5    | Check status badges                  | Active users: green badge "Active"                     |
|      |                                      | Inactive users: red badge "Inactive"                   |
| 6    | Check created date format            | Dates formatted as "Jan 10, 2025" (readable format)    |
| 7    | Verify default sort order            | Users sorted by created date (newest first)            |
| 8    | Count visible users                  | All users in database displayed (no pagination if <50) |

**Pass Criteria:**

- ✓ All required columns displayed
- ✓ Roles shown as friendly names
- ✓ Status badges color-coded correctly
- ✓ Dates formatted for readability
- ✓ Default sort order logical (newest first)

**Acceptance Criteria Covered:** AC2

---

## Test Scenario 9: Accessibility Testing

**Objective:** Verify user management interface is accessible

**Prerequisites:** Screen reader enabled (NVDA/JAWS/VoiceOver)

### Test Steps: Keyboard Navigation

| Step | Action                                  | Expected Result                                                                               |
| ---- | --------------------------------------- | --------------------------------------------------------------------------------------------- |
| 1    | Navigate to User Management page        | Page loads                                                                                    |
| 2    | Press Tab repeatedly                    | Focus moves through interactive elements in logical order:                                    |
|      |                                         | 1. Navigation links → 2. "Add User" button → 3. Table rows → 4. Action buttons                |
| 3    | Press Enter on "Add User" button        | Modal opens                                                                                   |
| 4    | Press Tab through modal                 | Focus moves through: Email input → Password → Role dropdown → Checkbox → Cancel → Create User |
| 5    | Press Escape                            | Modal closes, focus returns to "Add User" button                                              |
| 6    | Navigate to "Deactivate" button via Tab | Button focused (visible focus indicator)                                                      |
| 7    | Press Enter                             | Confirmation dialog opens                                                                     |
| 8    | Press Tab to "Confirm" button           | Focus on Confirm button                                                                       |
| 9    | Press Escape                            | Dialog closes                                                                                 |

### Test Steps: Screen Reader Announcements

| Step | Action                                           | Expected Result                                                    |
| ---- | ------------------------------------------------ | ------------------------------------------------------------------ |
| 1    | Navigate to user table with screen reader        | Table announced with row/column count                              |
| 2    | Navigate through table rows                      | Each cell content read aloud with context                          |
| 3    | Focus on "Active" status badge                   | "Active" or "Inactive" announced with semantic meaning             |
| 4    | Focus on "Deactivate" button (disabled for self) | "Deactivate, button, disabled. Cannot deactivate your own account" |
| 5    | Open Add User modal                              | "Add New User, dialog" announced                                   |
| 6    | Navigate to form fields                          | Labels read before input ("Email, edit text")                      |
| 7    | Trigger validation error                         | Error message announced immediately                                |

**Pass Criteria:**

- ✓ All interactive elements keyboard-accessible
- ✓ Focus visible and logical
- ✓ Escape key closes modals/dialogs
- ✓ Screen reader announces all content meaningfully
- ✓ ARIA labels present where needed

**Acceptance Criteria Covered:** Implicit (best practices)

---

## Test Scenario 10: Edge Cases and Error Handling

**Objective:** Verify system handles edge cases gracefully

### Test Case 10.1: Network Error During Creation

| Step | Action                           | Expected Result                                 |
| ---- | -------------------------------- | ----------------------------------------------- |
| 1    | Open DevTools, go to Network tab | Network tab open                                |
| 2    | Set network to "Offline" mode    | Network disabled                                |
| 3    | Attempt to create a user         | Error toast: "Failed to create user" or similar |
| 4    | Verify modal remains open        | Form data not lost                              |
| 5    | Re-enable network                | Network restored                                |
| 6    | Click "Create User" again        | Success (retry works)                           |

### Test Case 10.2: Very Long Email Address

| Step | Action                                             | Expected Result                     |
| ---- | -------------------------------------------------- | ----------------------------------- |
| 1    | Enter email with 254 characters (max valid length) | Email accepted if valid format      |
| 2    | Enter email with 255+ characters                   | Validation error or input truncated |

### Test Case 10.3: Special Characters in Password

| Step | Action                         | Expected Result                           |
| ---- | ------------------------------ | ----------------------------------------- |
| 1    | Enter password: `P@ssw0rd!#$%` | Password accepted (special chars allowed) |
| 2    | User created successfully      | Special character password works          |

### Test Case 10.4: Rapid Button Clicking

| Step | Action                                     | Expected Result                                         |
| ---- | ------------------------------------------ | ------------------------------------------------------- |
| 1    | Open Add User modal                        | Modal displayed                                         |
| 2    | Fill form with valid data                  | Form filled                                             |
| 3    | Click "Create User" button 5 times rapidly | Only 1 user created (button disabled after first click) |
| 4    | Check user list                            | Only 1 new user appears                                 |

**Pass Criteria:**

- ✓ Network errors handled gracefully
- ✓ Form data preserved on error
- ✓ Long emails validated correctly
- ✓ Special characters in passwords supported
- ✓ Double-submission prevented

**Acceptance Criteria Covered:** AC11 (error handling)

---

## Test Execution Checklist

**Before Testing:**

- [ ] Verify test environment is running (local/staging)
- [ ] Verify database has required test users
- [ ] Verify migrations applied (including RLS policies)
- [ ] Clear browser cache and cookies
- [ ] Disable browser extensions that might interfere

**After Testing:**

- [ ] Document any bugs found with screenshots
- [ ] Note performance issues or slow responses
- [ ] Record any UX improvements needed
- [ ] Clean up test data created during scenarios
- [ ] Submit test results to QA tracking system

---

## Test Results Summary

**Tester Name:** ******\_\_\_******  
**Test Date:** ******\_\_\_******  
**Environment:** ******\_\_\_******  
**Browser/Version:** ******\_\_\_******

| Scenario                                       | Status        | Notes |
| ---------------------------------------------- | ------------- | ----- |
| 1. Create New User with All Roles              | ☐ Pass ☐ Fail |       |
| 2. Deactivate User and Verify Login Prevention | ☐ Pass ☐ Fail |       |
| 3. Activate User and Verify Login Success      | ☐ Pass ☐ Fail |       |
| 4. Prevent Self-Deactivation                   | ☐ Pass ☐ Fail |       |
| 5. Form Validation Errors Display Correctly    | ☐ Pass ☐ Fail |       |
| 6. Role-Based Access Control                   | ☐ Pass ☐ Fail |       |
| 7. Duplicate Email Prevention                  | ☐ Pass ☐ Fail |       |
| 8. User List Display and Sorting               | ☐ Pass ☐ Fail |       |
| 9. Accessibility Testing                       | ☐ Pass ☐ Fail |       |
| 10. Edge Cases and Error Handling              | ☐ Pass ☐ Fail |       |

**Overall Assessment:** ☐ All Tests Pass ☐ Minor Issues ☐ Major Issues

**Bugs Found:** ******\_\_\_******

**Sign-off:** ******\_\_\_******  
**Date:** ******\_\_\_******
