# Manual Test Suite: Story 4.5 Real-Time Masterdata Synchronization

**Story:** 4.5 Real-Time Masterdata Synchronization  
**Test Date:** _To be completed during QA_  
**Tester:** _To be filled in by QA team_

---

## Test Environment Setup

### Prerequisites
1. Two browser windows (or different browsers)
2. Two test user accounts:
   - HR Admin account (e.g., `hr@example.com`)
   - External party account (e.g., `sodexo@example.com`)
3. Supabase real-time enabled in configuration
4. Development server running (`npm run dev`)

### Browser DevTools Setup
- Open browser DevTools console to monitor real-time events
- Open Network tab to verify WebSocket connections
- Enable verbose logging for debugging if needed

---

## Test 1: Two-Browser Real-Time Update Test (AC: 2, 3, 9)

**Objective:** Verify that changes made by HR Admin appear in external party view within 2 seconds

### Steps:
1. **Browser 1 Setup:**
   - Open application in incognito/private window
   - Login as HR Admin (`hr@example.com`)
   - Navigate to dashboard with employee table
   - Note the current time

2. **Browser 2 Setup:**
   - Open application in separate browser or incognito window
   - Login as Sodexo user (`sodexo@example.com`)
   - Navigate to dashboard with employee table
   - Verify "Live" connection indicator is visible and green

3. **Perform Update:**
   - In Browser 1 (HR Admin): Click on an employee's email field
   - Edit the email address (e.g., change `john@example.com` to `john.doe@example.com`)
   - Save the change
   - Start timer

4. **Verify Real-Time Update:**
   - In Browser 2 (Sodexo): Watch for the update to appear
   - Verify updated row has blue highlight animation
   - Verify row contains updated email address
   - Stop timer

### Expected Results:
- ✅ Updated email appears in Browser 2 within 2 seconds
- ✅ Updated row briefly shows blue background highlight
- ✅ Updated row shows blue left border (4px)
- ✅ Highlight animation fades after ~2 seconds
- ✅ Row maintains correct position (sort/filter not disrupted)
- ✅ Connection indicator shows "Live" status

---

## Test 2: Real-Time Employee Insertion (AC: 6)

**Objective:** Verify new employees appear in external party tables automatically

### Steps:
1. **Setup:** 
   - Browser 1: HR Admin logged in, employee table open
   - Browser 2: Sodexo user logged in, employee table open

2. **Create New Employee:**
   - In Browser 1: Click "Add Employee" button
   - Fill in employee details:
     - First Name: "Alice"
     - Surname: "Johnson"
     - SSN: "555-66-7777"
     - Email: "alice.johnson@example.com"
     - Hire Date: Today's date
   - Click "Save"

3. **Verify in Browser 2:**
   - Watch for new employee to appear in table
   - Verify row has highlight animation
   - Verify employee data is correct

### Expected Results:
- ✅ New employee appears in Browser 2 automatically
- ✅ New row shows highlight animation
- ✅ All employee data displayed correctly
- ✅ No page refresh required
- ✅ Update occurs within 2 seconds

---

## Test 3: Real-Time Employee Archival (AC: 7)

**Objective:** Verify archived employees disappear from external party views in real-time

### Steps:
1. **Setup:**
   - Browser 1: HR Admin with employee table open
   - Browser 2: Sodexo user with employee table open
   - Verify both see the same employee list

2. **Archive Employee:**
   - In Browser 1: Click archive icon for employee "Alice Johnson"
   - Confirm archival in dialog

3. **Verify in Browser 2:**
   - Watch employee list
   - Verify "Alice Johnson" disappears from table
   - Verify no error messages

### Expected Results:
- ✅ Employee row removed from Browser 2 automatically
- ✅ Removal occurs within 2 seconds
- ✅ No error messages or visual glitches
- ✅ Remaining employees unaffected

---

## Test 4: Sort and Filter Preservation (AC: 4)

**Objective:** Verify real-time updates maintain current sort and search filters

### Steps:
1. **Setup:**
   - Browser 1: HR Admin
   - Browser 2: Sodexo user

2. **Apply Filters in Browser 2:**
   - Enter "John" in search box
   - Click "Surname" column header to sort by surname (ascending)
   - Note current table state

3. **Make Update in Browser 1:**
   - Update an employee that matches filter (e.g., "John Doe")
   - Change rank from "Manager" to "Senior Manager"

4. **Verify Browser 2:**
   - Verify search filter still shows "John"
   - Verify sort order maintained (surname ascending)
   - Verify updated employee still visible with correct position
   - Verify highlight animation on updated row

### Expected Results:
- ✅ Search filter preserved after update
- ✅ Sort order unchanged
- ✅ Updated row remains in correct sorted position
- ✅ Update highlighted appropriately
- ✅ No table re-render or flicker

---

## Test 5: Connection Status Indicator (AC: 8)

**Objective:** Verify connection status indicator shows correct states

### Steps:
1. **Initial Connection:**
   - Open employee table
   - Verify connection indicator shows "Live" with green dot

2. **Simulate Disconnection:**
   - Open browser DevTools > Network tab
   - Set network throttling to "Offline"
   - Wait 5 seconds

3. **Verify Disconnected State:**
   - Check connection indicator
   - Verify shows "Offline" with gray dot

4. **Reconnection:**
   - Set network back to "Online"
   - Wait for reconnection

5. **Verify Reconnected:**
   - Verify indicator returns to "Live" with green dot

### Expected Results:
- ✅ Connected: Green dot + "Live" text
- ✅ Disconnected: Gray dot + "Offline" text
- ✅ Automatic reconnection when network restored
- ✅ ARIA live region announces status changes

---

## Test 6: Performance with Real-Time Active (AC: 10)

**Objective:** Verify no performance degradation with real-time sync

### Steps:
1. **Monitor Performance:**
   - Open browser DevTools > Performance tab
   - Start recording

2. **Perform Multiple Updates:**
   - In HR Admin window, update 5-10 employees rapidly
   - Edit different fields (name, email, rank, etc.)

3. **Monitor External Party View:**
   - Watch for updates appearing
   - Note any lag or delays
   - Check for memory usage spikes

4. **Stop Recording:**
   - Stop performance recording
   - Analyze results

### Expected Results:
- ✅ No noticeable UI lag during updates
- ✅ All updates appear within 2 seconds
- ✅ No memory leaks (check DevTools Memory tab)
- ✅ CPU usage remains reasonable
- ✅ Smooth animations without stuttering

---

## Test 7: Multiple Field Updates (AC: 2, 3, 5)

**Objective:** Verify multiple field updates on same employee work correctly

### Steps:
1. **Setup:** Two browsers as before

2. **Rapid Updates:**
   - In Browser 1 (HR Admin):
     - Update employee email
     - Wait 1 second
     - Update same employee's mobile number
     - Wait 1 second
     - Update same employee's rank

3. **Verify in Browser 2:**
   - Watch for all three updates
   - Verify highlight animation triggers for each
   - Verify all fields show correct data

### Expected Results:
- ✅ Each update triggers highlight animation
- ✅ All fields updated correctly
- ✅ No data loss or race conditions
- ✅ Updates appear in order

---

## Test 8: Cross-User Real-Time Isolation (Security)

**Objective:** Verify real-time events respect RLS policies

### Steps:
1. **Setup:**
   - Browser 1: Sodexo user
   - Browser 2: Different external party user (if available)

2. **Update Custom Column:**
   - In Browser 1: Update a custom Sodexo column value
   - Check Browser 2

3. **Verify:**
   - Ensure Browser 2 does NOT see Sodexo's custom data
   - Verify only authorized data is visible

### Expected Results:
- ✅ External party only sees own custom columns
- ✅ No unauthorized data leakage via real-time events
- ✅ RLS policies enforced on real-time subscriptions

---

## Test 9: Edge Case - Deleted Employee (AC: 7)

**Objective:** Verify behavior when employee is deleted (via archive then actual delete if implemented)

### Steps:
1. **Setup:** Two browsers

2. **Delete Scenario:**
   - Archive employee in Browser 1
   - If hard delete is implemented, delete the archived employee

3. **Verify:**
   - Employee removed from Browser 2
   - No errors in console

### Expected Results:
- ✅ Deleted employee removed from all views
- ✅ No JavaScript errors
- ✅ Clean removal with no visual artifacts

---

## Test 10: Long-Running Session Stability

**Objective:** Verify real-time connection remains stable over time

### Steps:
1. **Open Application:**
   - Login as external party user
   - Leave tab open for 30+ minutes

2. **Periodic Updates:**
   - Every 5-10 minutes, have HR Admin make an update

3. **Monitor:**
   - Verify updates continue to appear
   - Check connection status remains "Live"
   - Monitor for memory leaks

### Expected Results:
- ✅ Connection remains stable over 30+ minutes
- ✅ Updates continue to sync correctly
- ✅ No memory growth over time
- ✅ No automatic disconnections

---

## Performance Benchmarks

| Metric | Target | Actual | Pass/Fail |
|--------|--------|--------|-----------|
| Update Latency | <2 seconds | ___ seconds | ___ |
| Connection Establishment | <5 seconds | ___ seconds | ___ |
| Memory Usage (idle) | Stable | ___ MB | ___ |
| Memory Usage (after 100 updates) | <+50MB | ___ MB | ___ |
| CPU Usage (during updates) | <30% | ___% | ___ |

---

## Test Results Summary

**Total Tests:** 10  
**Passed:** ___  
**Failed:** ___  
**Blocked:** ___  

### Issues Found:
_List any bugs or issues discovered during testing_

---

## Sign-off

**Tester Name:** ________________  
**Date:** ________________  
**Signature:** ________________  

**Notes:**
_Any additional observations or recommendations_
